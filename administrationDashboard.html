<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Civil Servant - Administration Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Minimal inline styles to keep layout intact */
        body { background:#f5f7fb; font-family: Arial, sans-serif; }
        .navbar { background:#fff; border-bottom:1px solid #eee; }
        .nav-container { max-width:1200px; margin:0 auto; padding:10px 16px; display:flex; align-items:center; justify-content:space-between; }
        .logo { font-weight:700; color:#2c3e50; }
        .nav-menu { list-style:none; display:flex; gap:12px; margin:0; padding:0; }
        .nav-menu a { color:#2c3e50; text-decoration:none; }
        .admin-header { background:linear-gradient(135deg,#2c3e50,#1a2530); color:white; padding:24px 0; }
        .admin-header-content { max-width:1200px; margin:0 auto; padding:0 16px; display:flex; justify-content:space-between; align-items:center; }
        .admin-container { max-width:1200px; margin:24px auto; padding:0 16px 48px; }
        .stats-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:16px; margin-bottom:24px; }
        .stat-card { background:white; padding:16px; border-radius:8px; display:flex; align-items:center; gap:12px; }
        .stat-icon { width:56px; height:56px; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:18px; }
        .stat-info h3 { margin:0; font-size:1.4rem; }
        .dashboard-section { background:white; padding:16px; border-radius:8px; box-shadow:0 4px 18px rgba(0,0,0,0.03); }
        .applications-table { width:100%; border-collapse:collapse; }
        .applications-table th, .applications-table td { padding:10px; border-bottom:1px solid #f0f0f0; text-align:left; }
        .filter-controls { display:flex; gap:8px; }
        .filter-btn { padding:6px 10px; border-radius:6px; border:1px solid #ddd; background:#fff; cursor:pointer; }
        .filter-btn.active { background:#3498db; color:#fff; border-color:#3498db; }
        footer { padding:16px 0; margin-top:24px; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo"><i class="fas fa-landmark"></i> Civil Servant</div>
            <ul class="nav-menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="administrationDashboard.html" class="active">Admin Dashboard</a></li>
                <li><a href="index.html"> Logout</a></li>
                
            </ul>
        </div>
    </nav>

    <header class="admin-header">
        <div class="admin-header-content">
            <div class="admin-welcome">
                <h1><i class="fas fa-user-shield"></i> Administration Dashboard</h1>
                <p style="margin:0;color:#cbd6dd;">Manage all employee applications and requests</p>
            </div>
            <div class="admin-controls">
                <button class="filter-btn" id="refreshBtn"><i class="fas fa-sync-alt"></i> Refresh Data</button>
                <button class="filter-btn" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>
        </div>
    </header>

    <main class="admin-container">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon swapping"><i class="fas fa-exchange-alt"></i></div>
                <div class="stat-info"><h3 id="count-swap">0</h3><p style="margin:0;color:#7f8c8d;">Swapping Applications</p></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon relocation"><i class="fas fa-truck-moving"></i></div>
                <div class="stat-info"><h3 id="count-relocation">0</h3><p style="margin:0;color:#7f8c8d;">Relocation Requests</p></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon resignation"><i class="fas fa-user-minus"></i></div>
                <div class="stat-info"><h3 id="count-resignation">0</h3><p style="margin:0;color:#7f8c8d;">Resignation Applications</p></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon total"><i class="fas fa-file-alt"></i></div>
                <div class="stat-info"><h3 id="count-total">0</h3><p style="margin:0;color:#7f8c8d;">Total Applications</p></div>
            </div>
        </div>

        <div class="dashboard-section">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                <h2 style="margin:0;">All Applications</h2>
                <div class="filter-controls">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="swapping">Swapping</button>
                    <button class="filter-btn" data-filter="relocation">Relocation</button>
                    <button class="filter-btn" data-filter="resignation">Resignation</button>
                </div>
            </div>

            <div class="table-container">
                <table class="applications-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Applicant</th>
                            <th>Type</th>
                            <th>Department</th>
                            <th>Date Submitted</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="applications-table-body"></tbody>
                </table>
                <div id="no-applications" style="display:none;text-align:center;padding:20px;color:#7f8c8d;">No applications found</div>
            </div>
        </div>
    </main>

    <footer>
        <div style="max-width:1200px;margin:0 auto;padding:0 16px;color:#95a5a6;">
            &copy; <span class="current-year"></span> 
            Civil Servant Portal. All rights reserved.
        </div>
        <div>Developed By <a href="Victor Max.facebook" style="color: rgb(127, 127, 150);">Victor Muhakeya</a></div>
    </footer>

    <script src="script.js"></script>
    <script>
        (function(){
            let applications = [];

            function loadApplications() {
                if (typeof getApplications === 'function') {
                    applications = getApplications().map(a => ({ ...a, type: (a.type||'').toLowerCase() }));
                } else {
                    try { applications = JSON.parse(localStorage.getItem('applications') || '[]'); } catch (e) { applications = []; }
                }
            }

            function updateStatistics() {
                const swappingCount = applications.filter(app => (app.type||'') === 'swap' || (app.type||'') === 'swapping').length;
                const relocationCount = applications.filter(app => (app.type||'') === 'relocation').length;
                const resignationCount = applications.filter(app => (app.type||'') === 'resignation').length;
                const totalCount = applications.length;
                const elSwap = document.getElementById('count-swap');
                const elReloc = document.getElementById('count-relocation');
                const elResign = document.getElementById('count-resignation');
                const elTotal = document.getElementById('count-total');
                if (elSwap) elSwap.textContent = swappingCount;
                if (elReloc) elReloc.textContent = relocationCount;
                if (elResign) elResign.textContent = resignationCount;
                if (elTotal) elTotal.textContent = totalCount;
            }

            function populateApplicationsTable(filter='all'){
                const tableBody = document.getElementById('applications-table-body');
                const noApplications = document.getElementById('no-applications');
                let filtered = applications;
                if (filter !== 'all') filtered = applications.filter(a => (a.type||'') === filter || (filter==='swapping' && (a.type==='swap' || a.type==='swapping')));
                tableBody.innerHTML = '';
                if (!filtered || filtered.length===0){ tableBody.style.display='none'; noApplications.style.display='block'; return; }
                tableBody.style.display='table-row-group'; noApplications.style.display='none';
                filtered.forEach(app=>{
                    const dateObj = new Date(app.date || app.submissionDate || Date.now());
                    const formattedDate = dateObj.toLocaleDateString();
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${app.id||''}</td>
                        <td><strong>${app.requester||app.applicant||'Unknown'}</strong><br><small>${app.email||''}</small></td>
                        <td>${(app.type||'').toString()}</td>
                        <td>${app.department||''}</td>
                        <td>${formattedDate}</td>
                        <td>${app.status||''}</td>
                        <td><button class="filter-btn" onclick="alert('View not implemented in demo')">View</button></td>
                    `;
                    tableBody.appendChild(tr);
                });
            }

            document.addEventListener('DOMContentLoaded', function(){
                const userEmail = localStorage.getItem('userEmail');
                const userRole = localStorage.getItem('userRole');
                if (userRole !== 'admin' || userEmail !== 'admin@civilservant.gov'){
                    alert('Access denied. Administrator credentials required.');
                    window.location.href = 'login.html';
                    return;
                }

                document.querySelectorAll('.filter-btn[data-filter]').forEach(button=>{
                    button.addEventListener('click', function(){
                        document.querySelectorAll('.filter-btn[data-filter]').forEach(b=>b.classList.remove('active'));
                        this.classList.add('active');
                        const filter = this.getAttribute('data-filter');
                        populateApplicationsTable(filter);
                    });
                });

                const refreshBtn = document.getElementById('refreshBtn');
                if (refreshBtn) refreshBtn.addEventListener('click', function(){
                    refreshBtn.textContent = 'Refreshing...'; refreshBtn.disabled = true;
                    setTimeout(()=>{ loadApplications(); updateStatistics(); const activeFilter = document.querySelector('.filter-btn.active')?.getAttribute('data-filter') || 'all'; populateApplicationsTable(activeFilter); refreshBtn.textContent = 'Refresh Data'; refreshBtn.disabled = false; },600);
                });

                const logoutBtn = document.getElementById('logoutBtn');
                if (logoutBtn) logoutBtn.addEventListener('click', function(){ localStorage.removeItem('isLoggedIn'); localStorage.removeItem('userEmail'); localStorage.removeItem('userRole'); window.location.href = 'login.html'; });

                loadApplications(); updateStatistics(); populateApplicationsTable('all');

                window.addEventListener('applicationsUpdated', function(){ loadApplications(); updateStatistics(); const activeFilter = document.querySelector('.filter-btn.active')?.getAttribute('data-filter')||'all'; populateApplicationsTable(activeFilter); });
                window.addEventListener('storage', function(e){ if (!e) return; if (e.key==='applications' || e.key==='applications_updatedAt') { loadApplications(); updateStatistics(); const activeFilter = document.querySelector('.filter-btn.active')?.getAttribute('data-filter')||'all'; populateApplicationsTable(activeFilter); } });
            });
        })();
    </script>
</body>
</html>